<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mom.backend.XUSM1040">		
    <select id="get_findBtn1" parameterType="java.util.HashMap" resultType="com.mom.backend.dto.LowerHashMap">
	    <if test="startPage != null and startPage != '' and endPage != null and endPage != ''">
        SELECT A.*
	    FROM   (
	    </if>		
			    SELECT MU.COMPANY_CD
				     , MU.DIVISION_CD
				     , MU.USER_NO
				     , MU.USER_NM
				     , MU.USER_NM_ENG
				     , MU.PASSWORD
				     , MU.POSITION
				     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(MU.COMPANY_CD, MU.DIVISION_CD, 'SM0010', MU.POSITION) FROM DUAL) AS POSITION_NM
				     , MU.EMAIL
				     , MU.PHONE_NO
				     , MU.TEL_NO
				     , MU.FAX_NO
				     , MU.DEPT_CD
				     , (SELECT MOM_COMMON_PKG.FN_GET_DEPARTMENT_NAME(MU.COMPANY_CD, MU.DIVISION_CD, MU.DEPT_CD) FROM DUAL)  AS DEPT_NM
				     , MU.AUTH_GROUP_CD
				     , (SELECT MOM_COMMON_PKG.FN_GET_AUTH_NAME(MU.COMPANY_CD, MU.DIVISION_CD, MU.AUTH_GROUP_CD) FROM DUAL)   AS AUTH_GROUP_NM
				     , MU.VENDOR_CD
				     , (SELECT MOM_COMMON_PKG.FN_GET_PARTNER_NAME(MU.COMPANY_CD, MU.DIVISION_CD, MU.VENDOR_CD) FROM DUAL) AS VENDOR_NM
				     , MU.DEFAULT_LANGUAGE
				     , MU.MAP_ADDRESS
				     , MU.IP_ADDRESS
				     , MU.USE_YN
				     , MU.DESCRIPTION
				     , MU.CREATE_BY
				     , (SELECT MOM_COMMON_PKG.FN_GET_USER_NAME(MU.COMPANY_CD, MU.DIVISION_CD, MU.CREATE_BY) FROM DUAL)  AS CREATE_BY_NM
				     , TO_CHAR(MU.CREATE_DATE,'YYYY-MM-DD HH24:MI:SS') AS CREATE_DATE
				     , (SELECT MOM_COMMON_PKG.FN_GET_USER_NAME(MU.COMPANY_CD, MU.DIVISION_CD, MU.UPDATE_BY) FROM DUAL)  AS UPDATE_BY_NM
				     , TO_CHAR(MU.UPDATE_DATE,'YYYY-MM-DD HH24:MI:SS') AS UPDATE_DATE
				     , ROWIDTOCHAR(MU.ROWID) AS KEY_ID
	                 , COUNT(*) OVER() AS TOTAL_COUNT
	                 , ROW_NUMBER() OVER(PARTITION BY MU.COMPANY_CD,MU.DIVISION_CD ORDER BY MU.USER_NO ) AS ROW_COUNT 
				FROM   MOM_USER MU
				     , MOM_PARTNER MP
				WHERE  MU.COMPANY_CD   = MP.COMPANY_CD(+)
                AND    MU.DIVISION_CD  = MP.DIVISION_CD(+)
                AND    MU.VENDOR_CD    = MP.PARTNER_CD(+)  
                AND    MU.COMPANY_CD   = #{companyCd, jdbcType=VARCHAR}
				AND    MU.DIVISION_CD  = #{divisionCd, jdbcType=VARCHAR}	
			    <if test = "userNo != null and userNo != ''">
		        AND    UPPER(MU.USER_NO) LIKE '%' || UPPER(#{userNo, jdbcType=VARCHAR}) || '%'
		       </if>
		       <if test = "userNm != null and userNm != ''">
		        AND    UPPER(MU.USER_NM)  LIKE '%' || UPPER(#{userNm, jdbcType=VARCHAR}) || '%'
		       </if>
		       <if test = "deptNm != null and deptNm != ''">
		        AND    MU.DEPT_CD  IN (${deptNm})
		       </if>
		       <if test = "authGroupNm != null and authGroupNm != ''">
		        AND    MU.AUTH_GROUP_CD  IN (${authGroupNm})
		       </if>
		       <if test = "vendorNm != null and vendorNm != ''">
		        AND    UPPER(MP.PARTNER_NM)  LIKE '%' || UPPER(#{vendorNm, jdbcType=VARCHAR}) || '%'
		       </if>
		       <if test = "useYn != null and useYn != ''">
		        AND    MU.USE_YN  = #{useYn, jdbcType=VARCHAR}
		       </if>	
        <if test="startPage != null and startPage != '' and endPage != null and endPage != ''">
	           ) A
	    WHERE ROW_COUNT BETWEEN #{startPage, jdbcType=INTEGER} AND #{endPage, jdbcType=INTEGER}
	    </if> 	        
		ORDER BY USER_NO
	    </select>
	    <insert id="create_createBtn1" parameterType="java.util.List">  
            INSERT INTO MOM_USER (
							       COMPANY_CD
								 , DIVISION_CD
								 , USER_NO
								 , USER_NM
								 , USER_NM_ENG
								 , PASSWORD
								 , POSITION 
								 , EMAIL
								 , PHONE_NO
								 , TEL_NO
								 , FAX_NO
								 , DEPT_CD
								 , AUTH_GROUP_CD
								 , VENDOR_CD
								 , DEFAULT_LANGUAGE
								 , MAP_ADDRESS
								 , IP_ADDRESS
								 , USE_YN
								 , DESCRIPTION
								 , CREATE_BY
								 , CREATE_DATE
							 	 , UPDATE_BY
						 		 , UPDATE_DATE
		 							  )     
            VALUES(
		                <foreach item="item" collection="list" index="i" separator=" " open="">
						               #{item.companyCd,       jdbcType=VARCHAR}
						             , #{item.divisionCd,        jdbcType=VARCHAR}
						             , #{item.userNo,            jdbcType=VARCHAR}
						             , #{item.userNm,            jdbcType=INTEGER}
						             , #{item.userNmEng,         jdbcType=VARCHAR}
						             , #{item.encodePw,          jdbcType=VARCHAR} 
						             , #{item.position,          jdbcType=VARCHAR}
						             , #{item.email,             jdbcType=VARCHAR}
						             , #{item.phoneNo,           jdbcType=VARCHAR}
						             , #{item.telNo,             jdbcType=VARCHAR}
						             , #{item.faxNo,          	 jdbcType=VARCHAR}
						             , #{item.deptCd,    		 jdbcType=VARCHAR}
						             , #{item.authGroupCd, 	     jdbcType=VARCHAR}
						             , #{item.partnerCd,          jdbcType=VARCHAR}
						             , #{item.defaultLanguuage,  jdbcType=VARCHAR}
						             , #{item.mapAddress,    	 jdbcType=VARCHAR}
						             , #{item.ipAddress, 		 jdbcType=VARCHAR}
						             , #{item.useYn,             jdbcType=VARCHAR}
						             , #{item.description,       jdbcType=VARCHAR}
						             , TRIM(#{item.userId,       jdbcType=VARCHAR})
						             , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{item.divisionCd, jdbcType=VARCHAR}, #{item.companyCd, jdbcType=VARCHAR})
						             , TRIM(#{item.userId,       jdbcType=VARCHAR})
						             , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{item.divisionCd, jdbcType=VARCHAR}, #{item.companyCd, jdbcType=VARCHAR})
					)				             
			            </foreach>			               
        </insert>
    <insert id="create_copyBtn1" parameterType="java.util.List">
        INSERT INTO MOM_USER (
        COMPANY_CD
        , DIVISION_CD
        , USER_NO
        , USER_NM
        , USER_NM_ENG
        , PASSWORD
        , POSITION
        , EMAIL
        , PHONE_NO
        , TEL_NO
        , FAX_NO
        , DEPT_CD
        , AUTH_GROUP_CD
        , VENDOR_CD
        , DEFAULT_LANGUAGE
        , MAP_ADDRESS
        , IP_ADDRESS
        , USE_YN
        , DESCRIPTION
        , CREATE_BY
        , CREATE_DATE
        , UPDATE_BY
        , UPDATE_DATE
        )
        VALUES(
        <foreach item="item" collection="list" index="i" separator=" " open="">
            #{item.companyCd,       jdbcType=VARCHAR}
            , #{item.divisionCd,        jdbcType=VARCHAR}
            , #{item.userNo,            jdbcType=VARCHAR}
            , #{item.userNm,            jdbcType=INTEGER}
            , #{item.userNmEng,         jdbcType=VARCHAR}
            , #{item.encodePw,          jdbcType=VARCHAR}
            , #{item.position,          jdbcType=VARCHAR}
            , #{item.email,             jdbcType=VARCHAR}
            , #{item.phoneNo,           jdbcType=VARCHAR}
            , #{item.telNo,             jdbcType=VARCHAR}
            , #{item.faxNo,          	 jdbcType=VARCHAR}
            , #{item.deptCd,    		 jdbcType=VARCHAR}
            , #{item.authGroupCd, 	     jdbcType=VARCHAR}
            , #{item.partnerCd,          jdbcType=VARCHAR}
            , #{item.defaultLanguuage,  jdbcType=VARCHAR}
            , #{item.mapAddress,    	 jdbcType=VARCHAR}
            , #{item.ipAddress, 		 jdbcType=VARCHAR}
            , #{item.useYn,             jdbcType=VARCHAR}
            , #{item.description,       jdbcType=VARCHAR}
            , TRIM(#{item.userId,       jdbcType=VARCHAR})
            , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{item.divisionCd, jdbcType=VARCHAR}, #{item.companyCd, jdbcType=VARCHAR})
            , TRIM(#{item.userId,       jdbcType=VARCHAR})
            , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{item.divisionCd, jdbcType=VARCHAR}, #{item.companyCd, jdbcType=VARCHAR})
            )
        </foreach>
    </insert>
        <update id="modify_editBtn1" parameterType="java.util.List">     
         <foreach collection="list" item="item" separator=";" open="DECLARE BEGIN" close=";END;">
           UPDATE MOM_USER
           SET USER_NM                = #{item.userNm,              jdbcType=VARCHAR}
		     , PASSWORD               = #{item.encodePw,            jdbcType=VARCHAR}
			 , USER_NM_ENG            = #{item.userNmEng,           jdbcType=VARCHAR}
			 , AUTH_GROUP_CD		  = #{item.authGroupCd,         jdbcType=VARCHAR}
			 , DEPT_CD  	          = #{item.deptCd,              jdbcType=VARCHAR}
			 , POSITION               = #{item.position,          jdbcType=VARCHAR}			 
			 , TEL_NO                 = #{item.telNo,               jdbcType=VARCHAR}
			 , PHONE_NO               = #{item.phoneNo,             jdbcType=VARCHAR} 
			 , FAX_NO                 = #{item.faxNo,               jdbcType=VARCHAR}
			 , EMAIL                  = #{item.email,               jdbcType=VARCHAR}
			 , MAP_ADDRESS            = #{item.mapAddress,          jdbcType=VARCHAR}
			 , IP_ADDRESS             = #{item.ipAddress,           jdbcType=VARCHAR}
			 , VENDOR_CD              = #{item.partnerCd,            jdbcType=VARCHAR}
			 , USE_YN                 = #{item.useYn,               jdbcType=VARCHAR}
			 , DESCRIPTION            = #{item.description,         jdbcType=VARCHAR}
		     , UPDATE_BY              = #{item.userId,              jdbcType=VARCHAR}
		     , UPDATE_DATE            = MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{item.divisionCd, jdbcType=VARCHAR}, #{item.companyCd, jdbcType=VARCHAR})		     
         <where>
                COMPANY_CD    = #{item.companyCd,   jdbcType=VARCHAR}
            AND DIVISION_CD   = #{item.divisionCd,  jdbcType=VARCHAR}
            AND USER_NO       = #{item.userNo,      jdbcType=VARCHAR}
         </where>
      </foreach>
      </update> 
      <delete id = "remove_delBtn1" parameterType ="java.util.List">
                DELETE FROM MOM_USER 
               <where>
               <foreach collection="list" item="item"  open="" separator="OR" close="">
               (      COMPANY_CD    = #{item.companyCd,   jdbcType=VARCHAR}
                  AND DIVISION_CD   = #{item.divisionCd,  jdbcType=VARCHAR}
                  AND USER_NO       = #{item.userNo,      jdbcType=VARCHAR}
               )      
             </foreach>
            </where>  
      </delete>
  <insert id="upsert_excelUpBtn1" parameterType="java.util.HashMap">
      MERGE INTO MOM_USER 
            USING( 
                         SELECT #{companyCd, jdbcType=VARCHAR} as companyCd,
                            #{divisionCd, jdbcType=VARCHAR} as divisionCd,
                            #{userNo, jdbcType=VARCHAR} as userNo,
                            #{userNm, jdbcType=VARCHAR} as userNm,
                            #{userNmEng, jdbcType=VARCHAR} as userNmEng,
                            #{encodePw, jdbcType=VARCHAR} as password,
                            #{position, jdbcType=VARCHAR} as position,
                            #{email, jdbcType=VARCHAR} as email,
                            #{phoneNo, jdbcType=VARCHAR} as phoneNo,
                            #{telNo, jdbcType=VARCHAR} as telNo,
                            #{faxNo, jdbcType=VARCHAR} as faxNo,
                            #{deptCd, jdbcType=VARCHAR} as deptCd,
                            #{authGroupCd, jdbcType=VARCHAR} as authGroupCd,
                            #{partnerCd, jdbcType=VARCHAR} as partnerCd,
                            #{defaultLanguage, jdbcType=VARCHAR} as defaultLanguage,
                            #{mapAddress, jdbcType=VARCHAR} as mapAddress,
                            #{ipAddress, jdbcType=VARCHAR} as ipAddress,
                            #{useYn, jdbcType=VARCHAR} as useYn,
                            #{description, jdbcType=VARCHAR} as description,
                            #{userId, jdbcType=VARCHAR} as createBy,
                            MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{companyCd, jdbcType=VARCHAR},#{divisionCd, jdbcType=VARCHAR}) as createDate,
                            #{userId, jdbcType=VARCHAR} as updateBy,
                            MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{companyCd, jdbcType=VARCHAR},#{divisionCd, jdbcType=VARCHAR}) as updateDate
                     FROM DUAL
                   ) PARAM
            ON ( COMPANY_CD = PARAM.companyCd AND
                 DIVISION_CD = PARAM.divisionCd AND
                 USER_NO = PARAM.userNo )
            WHEN MATCHED THEN 
                     UPDATE SET USER_NM = PARAM.userNm
                          , USER_NM_ENG = PARAM.userNmEng
                          , PASSWORD = PARAM.password
                          , POSITION = PARAM.position
                          , EMAIL = PARAM.email
                          , PHONE_NO = PARAM.phoneNo
                          , TEL_NO = PARAM.telNo
                          , FAX_NO = PARAM.faxNo
                          , DEPT_CD = PARAM.deptCd
                          , AUTH_GROUP_CD = PARAM.authGroupCd
                          , VENDOR_CD = PARAM.partnerCd
                          , DEFAULT_LANGUAGE = PARAM.defaultLanguage
                          , MAP_ADDRESS = PARAM.mapAddress
                          , IP_ADDRESS = PARAM.ipAddress
                          , USE_YN = PARAM.useYn
                          , DESCRIPTION = PARAM.description                
                          , UPDATE_BY = PARAM.updateBy
                          , UPDATE_DATE = PARAM.updateDate
                        
            WHEN NOT MATCHED THEN
                     INSERT ( COMPANY_CD
                            , DIVISION_CD
                            , USER_NO
                            , USER_NM
                            , USER_NM_ENG
                            , PASSWORD
                            , POSITION
                            , EMAIL
                            , PHONE_NO
                            , TEL_NO
                            , FAX_NO
                            , DEPT_CD
                            , AUTH_GROUP_CD
                            , VENDOR_CD
                            , DEFAULT_LANGUAGE
                            , MAP_ADDRESS
                            , IP_ADDRESS
                            , USE_YN
                            , DESCRIPTION
                            , CREATE_BY
                            , CREATE_DATE
                            , UPDATE_BY
                            , UPDATE_DATE )
                     VALUES ( PARAM.companyCd
                            , PARAM.divisionCd
                            , PARAM.userNo
                            , PARAM.userNm
                            , PARAM.userNmEng
                            , PARAM.password
                            , PARAM.position
                            , PARAM.email
                            , PARAM.phoneNo
                            , PARAM.telNo
                            , PARAM.faxNo
                            , PARAM.deptCd
                            , PARAM.authGroupCd
                            , PARAM.partnerCd
                            , PARAM.defaultLanguage
                            , PARAM.mapAddress
                            , PARAM.ipAddress
                            , PARAM.useYn
                            , PARAM.description
                            , PARAM.createBy
                            , PARAM.createDate
                            , PARAM.updateBy
                            , PARAM.updateDate )
  </insert>      
</mapper>
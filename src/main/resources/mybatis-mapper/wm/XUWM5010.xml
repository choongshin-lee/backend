<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mom.backend.XUWM5010">
    <select id="get_findBtn1" parameterType="java.util.HashMap"  resultType="com.mom.backend.dto.LowerHashMap" fetchSize="1000">
        <if test="startPage != null and startPage != '' and endPage != null and endPage != ''">
	        SELECT A.*
	        FROM   (
	    </if>
	                SELECT MPD.COMPANY_CD
	                     , MPD.DIVISION_CD
	                     , MPD.PROCESS_CD         
		                 , (SELECT MOM_COMMON_PKG.FN_GET_PROCESS_NAME(MPD.COMPANY_CD, MPD.DIVISION_CD, MPD.PROCESS_CD) FROM DUAL)  AS PROCESS_NM
		                 , MPD.IO_TYPE
	                     , (SELECT MOM_COMMON_PKG.FN_GET_IO_TYPE_NAME(MPD.COMPANY_CD, MPD.DIVISION_CD, MPD.IO_TYPE) FROM DUAL)  AS IO_TYPE_NM
	                     , MPD.REFERENCE_NO 
						 , MPD.REFERENCE_DTL_NO 
	                     , MPD.ITEM_ID
	                     , MI.ITEM_NM
	                     , MI.ITEM_SPEC
	                     , MI.ITEM_TYPE
	                     , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(MI.COMPANY_CD, MI.DIVISION_CD, 'MD0002', MI.ITEM_TYPE, #{langCd, jdbcType=VARCHAR}) FROM DUAL)  AS ITEM_TYPE_NM
	                     , MPD.FROM_WAREHOUSE_CD    AS REQUEST_WAREHOUSE_CD
                         , MWF.WAREHOUSE_NM        AS REQUEST_WAREHOUSE_NM
                         , MPD.TO_WAREHOUSE_CD      AS ISSUE_WAREHOUSE_CD 
                         , MWT.WAREHOUSE_NM        AS ISSUE_WAREHOUSE_NM
	                     , MPD.QTY                AS ISSUE_QTY
	                     , MPD.APPLY_FLAG
	                     , TO_CHAR(MPD.CREATE_DATE ,'YYYY-MM-DD HH24:MI:SS') AS CREATE_DATE
	                     , MPD.CREATE_BY                                     AS REQUEST_USER_NO 
	                     ,(SELECT MOM_COMMON_PKG.FN_GET_USER_NAME(MPD.COMPANY_CD, MPD.DIVISION_CD, MPD.CREATE_BY) FROM DUAL ) AS REQUEST_USER_NM
	                     , ROWIDTOCHAR(MPD.ROWID)            AS KEY_ID
	                     , COUNT(*) OVER()   AS TOTAL_COUNT
	                     , ROW_NUMBER() OVER(PARTITION BY MPD.COMPANY_CD,MPD.DIVISION_CD ORDER BY MPD.REFERENCE_DTL_NO) AS ROW_CNT
	                FROM   MOM_PRODUCT_DELIVERY_SHEET MPD
	                     , MOM_ITEM MI
	                     , MOM_WAREHOUSE MWF
                         , MOM_WAREHOUSE MWT
	                WHERE  MPD.COMPANY_CD        = MI.COMPANY_CD
	                AND    MPD.DIVISION_CD       = MI.DIVISION_CD
	                AND    MPD.ITEM_ID           = MI.ITEM_ID     
	                AND    MPD.COMPANY_CD        = MWF.COMPANY_CD
                    AND    MPD.DIVISION_CD       = MWF.DIVISION_CD
                    AND    MPD.FROM_WAREHOUSE_CD = MWF.WAREHOUSE_CD      
                    AND    MPD.COMPANY_CD        = MWT.COMPANY_CD
                    AND    MPD.DIVISION_CD       = MWT.DIVISION_CD
                    AND    MPD.TO_WAREHOUSE_CD   = MWT.WAREHOUSE_CD    
	                AND    MPD.COMPANY_CD        = #{companyCd, jdbcType=VARCHAR}
	                AND    MPD.DIVISION_CD       = #{divisionCd, jdbcType=VARCHAR} 
	                AND    MPD.CREATE_DATE       BETWEEN TO_DATE(#{createDateSD, jdbcType=VARCHAR}, 'YYYY-MM-DD')  AND TO_DATE(#{createDateED, jdbcType=VARCHAR}, 'YYYY-MM-DD') + 0.99999
	                <if test="applyFlag != null and applyFlag != ''">
					AND    MPD.APPLY_FLAG  = #{applyFlag, jdbcType=VARCHAR}
					</if>   
					<if test="processCd != null and processCd != ''">
					AND    MPD.PROCESS_CD  = #{processCd, jdbcType=VARCHAR}
					</if>  
					<if test="requestWarehouseCdNm != null and requestWarehouseCdNm != ''">
	                AND    (UPPER(MPD.FROM_WAREHOUSE_CD) LIKE '%' || UPPER(#{requestWarehouseCdNm, jdbcType=VARCHAR}) || '%' OR UPPER(MWF.WAREHOUSE_NM) LIKE '%' || UPPER(#{requestWarehouseCdNm, jdbcType=VARCHAR}) || '%')    
	                </if> 
	                <if test="issueWarehouseCdNm != null and issueWarehouseCdNm != ''">
	                AND    (UPPER(MPD.TO_WAREHOUSE_CD) LIKE '%' || UPPER(#{issueWarehouseCdNm, jdbcType=VARCHAR}) || '%' OR UPPER(MWT.WAREHOUSE_NM) LIKE '%' || UPPER(#{issueWarehouseCdNm, jdbcType=VARCHAR}) || '%')    
	                </if> 
	                <if test="itemIdNm != null and itemIdNm != ''">
	                AND    (UPPER(MI.ITEM_ID) LIKE '%' || UPPER(#{itemIdNm, jdbcType=VARCHAR}) || '%' OR UPPER(MI.ITEM_NM) LIKE '%' || UPPER(#{itemIdNm, jdbcType=VARCHAR}) || '%')	  
	                </if>
	                <if test="referenceNo != null and referenceNo != ''">
	                AND    (UPPER(MPD.REFERENCE_NO) LIKE '%' || UPPER(#{referenceNo, jdbcType=VARCHAR}) || '%' )    
	                </if> 
	                <if test="referenceDtlNo != null and referenceDtlNo != ''">
	                AND    (UPPER(MPD.REFERENCE_DTL_NO) LIKE '%' || UPPER(#{referenceDtlNo, jdbcType=VARCHAR}) || '%' )    
	                </if> 	                
	    <if test="startPage != null and startPage != '' and endPage != null and endPage != ''">
	               ) A
	        WHERE ROW_CNT BETWEEN #{startPage, jdbcType=INTEGER} AND #{endPage, jdbcType=INTEGER}
	    </if>             
    </select> 
</mapper>    
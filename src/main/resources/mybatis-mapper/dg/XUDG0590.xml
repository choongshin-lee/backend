<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mom.backend.XUDG0590">
<select id="get_findBtn21" parameterType="java.util.HashMap" resultType="com.mom.backend.dto.LowerHashMap">
    <if test="startPage != null and startPage != '' and endPage != null and endPage != ''">
        SELECT A.*
        FROM   (
    </if>
                SELECT MSO.COMPANY_CD
				     , MSO.DIVISION_CD
				     , MSO.PROCESS_CD
				     , (SELECT MOM_COMMON_PKG.FN_GET_PROCESS_NAME(MSO.COMPANY_CD, MSO.DIVISION_CD, MSO.PROCESS_CD) FROM DUAL)  AS PROCESS_NM
				     , MSO.SHIPPING_NO
				     , MSO.SHIPPING_NM
				     , MSO.CUSTOMER_CD
				     ,(SELECT MOM_COMMON_PKG.FN_GET_PARTNER_NAME(MSO.COMPANY_CD, MSO.DIVISION_CD, MSO.CUSTOMER_CD) FROM DUAL) AS  CUSTOMER_NM
				     , MSO.DESTINATION_CD
				     ,(SELECT MOM_COMMON_PKG.FN_GET_PARTNER_NAME(MSO.COMPANY_CD, MSO.DIVISION_CD, MSO.DESTINATION_CD) FROM DUAL) AS  DESTINATION_NM
				     , MSO.FORWARDER_CD
				     ,(SELECT MOM_COMMON_PKG.FN_GET_PARTNER_NAME(MSO.COMPANY_CD, MSO.DIVISION_CD, MSO.FORWARDER_CD) FROM DUAL) AS  FORWARDER_NM
				     , MSO.NOTIFY_PARTY_CD
				     ,(SELECT MOM_COMMON_PKG.FN_GET_PARTNER_NAME(MSO.COMPANY_CD, MSO.DIVISION_CD, MSO.NOTIFY_PARTY_CD) FROM DUAL) AS  NOTIFY_PARTY_NM
				     , MSO.LOADING_PLACE_CD
				     ,(SELECT MOM_COMMON_PKG.FN_GET_PARTNER_NAME(MSO.COMPANY_CD, MSO.DIVISION_CD, MSO.LOADING_PLACE_CD) FROM DUAL) AS  LOADING_PLACE_NM
				     , MSO.DESTINATION_PORT_CD
				     ,(SELECT MOM_COMMON_PKG.FN_GET_PARTNER_NAME(MSO.COMPANY_CD, MSO.DIVISION_CD, MSO.DESTINATION_PORT_CD) FROM DUAL) AS  DESTINATION_PORT_NM
				     , MSO.SHIPPING_WAREHOUSE_CD
				     , (SELECT MOM_COMMON_PKG.FN_GET_WAREHOUSE_NAME(MSO.COMPANY_CD, MSO.DIVISION_CD, MSO.SHIPPING_WAREHOUSE_CD) FROM DUAL ) AS SHIPPING_WAREHOUSE_NM
				     , TO_CHAR(MSO.SHIPPING_DUE_DATE ,'YYYY-MM-DD') AS SHIPPING_DUE_DATE
				     , MSO.CREATE_BY          AS CREATE_USER_NO
				     , (SELECT MOM_COMMON_PKG.FN_GET_USER_NAME(MSO.COMPANY_CD, MSO.DIVISION_CD, MSO.CREATE_BY) FROM DUAL ) AS CREATE_USER_NM
				     , TO_CHAR(MSO.CREATE_DATE ,'YYYY-MM-DD')            AS CREATE_DATE
				     , ROWIDTOCHAR(MSO.ROWID)            AS KEY_ID
				     , COUNT(*) OVER()                   AS TOTAL_COUNT
				     , ROW_NUMBER() OVER(PARTITION BY MSO.COMPANY_CD,MSO.DIVISION_CD ORDER BY MSO.SHIPPING_NO) AS ROW_CNT
				FROM   MOM_SHIPPING_ORDER_MST MSO
				WHERE  MSO.COMPANY_CD   = #{companyCd, jdbcType=VARCHAR}
				AND    MSO.DIVISION_CD  = #{divisionCd, jdbcType=VARCHAR}  
				AND    MSO.STATE        = 'SHA'
				AND    MSO.CUSTOMER_CD  = #{customerCd, jdbcType=VARCHAR} 
				AND    NVL(MSO.DESTINATION_CD, '***')      = NVL(#{destinationCd, jdbcType=VARCHAR}, '***')
				AND    NVL(MSO.FORWARDER_CD, '***')        = NVL(#{forwarderCd, jdbcType=VARCHAR}, '***')
				AND    NVL(MSO.NOTIFY_PARTY_CD, '***')     = NVL(#{notifyPartyCd, jdbcType=VARCHAR}, '***')
				AND    NVL(MSO.LOADING_PLACE_CD, '***')    = NVL(#{loadingPlaceCd, jdbcType=VARCHAR}, '***')
				AND    NVL(MSO.DESTINATION_PORT_CD, '***') = NVL(#{destinationPortCd, jdbcType=VARCHAR}, '***')
    <if test="startPage != null and startPage != '' and endPage != null and endPage != ''">
               ) A
        WHERE ROW_CNT BETWEEN #{startPage, jdbcType=INTEGER} AND #{endPage, jdbcType=INTEGER}
    </if> 
</select>  
    <delete id="remove_customBtn21-1" parameterType="java.util.List">
        DELETE FROM MOM_PROC_PACKING_DTL
        <where>
	        <foreach collection="list" item="item" open="" close="" separator="OR">
	        (       COMPANY_CD       = #{item.companyCd, jdbcType=VARCHAR}
	           AND  DIVISION_CD      = #{item.divisionCd, jdbcType=VARCHAR}
	           AND  CREATE_BY        = #{item.userId, jdbcType=VARCHAR}
	        )
	        </foreach>
        </where>
   </delete>  
   <insert id="create_customBtn21-1" parameterType="java.util.List">
       <foreach item="item" collection="list" index="i" separator=" " open="INSERT ALL" close="SELECT * FROM DUAL"> 
	       INTO MOM_PROC_PACKING_DTL( COMPANY_CD
					                , DIVISION_CD
					                , PACKING_ID
					                , PACKING_DETAIL_ID
					                , REFERENCE_NO
					                , REFERENCE_DTL_NO
					                , DESCRIPTION
					                , DEL_YN
                                    , VAL_MSG
                                    , MULTI_MSG
                                    , CREATE_BY
                                    , CREATE_DATE)
           VALUES                   ( #{item.companyCd, jdbcType=VARCHAR}  
                                    , #{item.divisionCd, jdbcType=VARCHAR} 
                                    , #{item.packingId, jdbcType=VARCHAR}
                                    , #{item.packingDetailId, jdbcType=VARCHAR}
                            		, #{item.shippingNo, jdbcType=VARCHAR}
		                            , #{item.shippingOrderId, jdbcType=VARCHAR}
		                            , #{item.description, jdbcType=VARCHAR}
		                            , 'N'
		                            , #{item.valMsg, jdbcType=VARCHAR}
		                            , #{item.multiMsg, jdbcType=VARCHAR}
		                            , #{item.userId, jdbcType=VARCHAR}
		                            , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{item.companyCd, jdbcType=VARCHAR},#{item.divisionCd, jdbcType=VARCHAR})
		                            )
        </foreach>
    </insert>
    <select id="proc_customBtn21-1" statementType="CALLABLE" parameterType="java.util.HashMap" resultType="com.mom.backend.dto.LowerHashMap">  
        { CALL MOM_WMS_PKG.SP_UPSERT_PACKING_DTL( #{p_err_code,  jdbcType=VARCHAR, mode=OUT}
                                                , #{p_err_msg,   jdbcType=VARCHAR, mode=OUT}
                                                , #{companyCd,   jdbcType=VARCHAR, mode=IN}
                                                , #{divisionCd,  jdbcType=VARCHAR, mode=IN} 
                                                , #{userId,      jdbcType=VARCHAR, mode=IN} )}     
    </select>    
</mapper>    
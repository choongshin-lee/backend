<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mom.backend.XUDG0250">
    <select id="get_findBtn21" parameterType="java.util.HashMap" resultType="com.mom.backend.dto.LowerHashMap">
		SELECT MLM.COMPANY_CD
		     , MLM.DIVISION_CD
		     , MLM.RECEIPT_ID
		     , MLD.SEQ
		     , MLD.RECEIPT_DETAIL_ID
		     , MLM.LOCATION_CD            RECEIPT_LOCATION_CD
		     , (SELECT MOM_COMMON_PKG.FN_GET_LOCATION_NAME(MLM.COMPANY_CD,MLM.DIVISION_CD,MLM.LOCATION_CD) FROM DUAL)         AS RECEIPT_LOCATION_NM
		     , MLM.PROCESS_TYPE
		     , (SELECT MOM_COMMON_PKG.FN_GET_PROCESS_TYPE_NAME(MLM.COMPANY_CD, MLM.DIVISION_CD, MLM.PROCESS_TYPE) FROM DUAL)  AS PROCESS_TYPE_NM
		     , MLM.RECEIPT_TYPE_CD
		     , (SELECT MOM_COMMON_PKG.FN_GET_RECEIPT_TYPE_NAME(MLM.COMPANY_CD, MLM.DIVISION_CD, MLM.RECEIPT_TYPE_CD) FROM DUAL)  AS RECEIPT_TYPE_NM
		     , MLD.IO_TYPE
		     , (SELECT MOM_COMMON_PKG.FN_GET_IO_TYPE_NAME(MLD.COMPANY_CD, MLD.DIVISION_CD, MLD.IO_TYPE) FROM DUAL)            AS IO_TYPE_NM
		     , MLD.ITEM_ID
		     , MI.ITEM_NM
				 , MI.ITEM_SPEC
				 , MI.ITEM_TYPE
				 , (SELECT MOM_COMMON_PKG.FN_GET_CODE_NAME(MI.COMPANY_CD, MI.DIVISION_CD, 'MD0002', MI.ITEM_TYPE, #{langCd, jdbcType=VARCHAR}) FROM DUAL)  AS ITEM_TYPE_NM
		     , MLD.UNIT
		     , (SELECT MOM_COMMON_PKG.FN_GET_UNIT_NAME(MLD.COMPANY_CD, MLD.DIVISION_CD, MLD.UNIT) FROM DUAL) AS UNIT_NM
		     , MLD.RECEIPT_QTY
		     , MLD.REFERENCE_NO
		     , MLD.REFERENCE_DTL_NO
		     , MLD.DESCRIPTION
		     , MLD.UPDATE_BY
		     , MLD.UPDATE_DATE
		     , ROWIDTOCHAR(MLD.ROWID)            AS KEY_ID
		FROM   MOM_LOCATION_RECEIPT_MST MLM
		     , MOM_LOCATION_RECEIPT_DTL MLD
		     , MOM_ITEM MI
		WHERE  MLM.COMPANY_CD      = MLD.COMPANY_CD
		AND    MLM.DIVISION_CD     = MLD.DIVISION_CD
		AND    MLM.RECEIPT_ID      = MLD.RECEIPT_ID  
		AND    MLD.COMPANY_CD      = MI.COMPANY_CD
		AND    MLD.DIVISION_CD     = MI.DIVISION_CD
		AND    MLD.ITEM_ID         = MI.ITEM_ID    
		AND    MLM.COMPANY_CD      = #{companyCd, jdbcType=VARCHAR}
		AND    MLM.DIVISION_CD     = #{divisionCd, jdbcType=VARCHAR}    
		AND    MLD.STATE           = 'LRF'   -- 확정 대상
		AND    MLM.LOCATION_CD     = #{locationCd, jdbcType=VARCHAR}
		AND    MLM.PROCESS_TYPE    = #{processType, jdbcType=VARCHAR}
		AND    MLM.RECEIPT_TYPE_CD = #{receiptTypeCd, jdbcType=VARCHAR}
    </select>
    <delete id="remove_customBtn21-1" parameterType="java.util.List">
	    DELETE FROM MOM_PROC_LOCATION_PICKING_DTL
	    <where>
	        <foreach collection="list" item="item" open="" close="" separator="OR">
	        (       COMPANY_CD  = #{item.companyCd, jdbcType=VARCHAR}
	           AND  DIVISION_CD = #{item.divisionCd, jdbcType=VARCHAR}
	           AND  CREATE_BY   = #{item.userId, jdbcType=VARCHAR}
	        )
	        </foreach>
	    </where>
	</delete>  
	<insert id="create_customBtn21-1" parameterType="java.util.List">
	    <foreach item="item" collection="list" index="i" separator=" " open="INSERT ALL" close="SELECT * FROM DUAL"> 
	    INTO MOM_PROC_LOCATION_PICKING_DTL( COMPANY_CD
	                                      , DIVISION_CD
	                                      , PICKING_ID
	                                      , SEQ
	                                      , ITEM_ID
	                                      , UNIT
	                                      , QTY
	                                      , REFERENCE_NO
	                                      , REFERENCE_DTL_NO
	                                      , PICKING_DETAIL_ID
	                                      , DESCRIPTION
	                                      , DEL_YN
	                                      , VAL_MSG
	                                      , MULTI_MSG
	                                      , CREATE_BY
	                                      , CREATE_DATE
	                                      )
	    VALUES                            ( #{item.companyCd, jdbcType=VARCHAR}  
	                                      , #{item.divisionCd, jdbcType=VARCHAR}         
	                                      , #{item.pickingId, jdbcType=VARCHAR}
	                                      , #{item.seq, jdbcType=NUMERIC}
	                                      , #{item.itemId, jdbcType=VARCHAR}
	                                      , #{item.unit, jdbcType=VARCHAR}
	                                      , #{item.referenceNo, jdbcType=VARCHAR}
	                                      , #{item.referenceDtlNo, jdbcType=VARCHAR}
	                                      , #{item.pickingDetailId, jdbcType=VARCHAR}
	                                      , #{item.description, jdbcType=VARCHAR}
	                                      , #{item.delYn, jdbcType=VARCHAR}
	                                      , #{item.valMsg, jdbcType=VARCHAR}
	                                      , #{item.multiMsg, jdbcType=VARCHAR}
	                                      , #{item.userId, jdbcType=VARCHAR}
	                                      , MOM_COMMON_PKG.FN_GET_LOCAL_TIME(#{item.companyCd, jdbcType=VARCHAR},#{item.divisionCd, jdbcType=VARCHAR})
	                                      )
	    </foreach>
	</insert>
	<select id="proc_customBtn21-1" statementType="CALLABLE" parameterType="java.util.HashMap" resultType="com.mom.backend.dto.LowerHashMap">  
	    { CALL MOM_WMS_PKG.SP_UPSERT_LOCATION_PICKING_DTL( #{p_err_code,  jdbcType=VARCHAR, mode=OUT}
	                                                     , #{p_err_msg,   jdbcType=VARCHAR, mode=OUT}
	                                                     , #{companyCd,   jdbcType=VARCHAR, mode=IN}
	                                                     , #{divisionCd,  jdbcType=VARCHAR, mode=IN}    
	                                                     , #{userId,      jdbcType=VARCHAR, mode=IN} )}                   
	</select>    
</mapper>
